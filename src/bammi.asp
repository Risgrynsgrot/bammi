

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
"http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>
<TITLE>Bammi - The Exploding Pie Game - Bammi.com</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="keywords" CONTENT="Bammi, The Exploding Pie Game">
<META NAME="description" CONTENT="An original strategy game of recursive exploding pies">
<META NAME="Author" CONTENT="Traffic Names 1999-2021  - http://www.TrafficNames.com">
<META NAME="Copyright" CONTENT="Traffic Names 1999-2021  - http://www.TrafficNames.com">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-57x57-precomposed.png">
<STYLE type="text/css">
body
{
background-color: #D0D0D0;
margin: 0px;
}
h1
{
font-size:36px; display: inline;
}
td,p
{
font-size: 12px;
}
.maintbl td
{
text-align:center;
border:0px solid #000;
}
td.tx0 {border-width:0px 0px 0px 0px ;}
td.tx1 {border-width:1px 0px 0px 0px ;}
td.tx2 {border-width:0px 1px 0px 0px ;}
td.tx3 {border-width:1px 1px 0px 0px ;}
td.tx4 {border-width:0px 0px 1px 0px ;}
td.tx5 {border-width:1px 0px 1px 0px ;}
td.tx6 {border-width:0px 1px 1px 0px ;}
td.tx7 {border-width:1px 1px 1px 0px ;}
td.tx8 {border-width:0px 0px 0px 1px ;}
td.tx9 {border-width:1px 0px 0px 1px ;}
td.tx10 {border-width:0px 1px 0px 1px ;}
td.tx11 {border-width:1px 1px 0px 1px ;}
td.tx12 {border-width:0px 0px 1px 1px ;}
td.tx13 {border-width:1px 0px 1px 1px ;}
td.tx14 {border-width:0px 1px 1px 1px ;}
td.tx15 {border-width:1px 1px 1px 1px ;}


.menucolumn
{
background-color: #F0F0F0;
}
ul
{
margin:0px;
}
.menutext
{
font-weight: bold;
position:relative;
left: -20px;
margin-bottom: 0px;
}
#menulist p
{
padding:0px 0px 5px 30px;
margin: 0px;
text-indent:-20px;
}
.sitemap td
{
padding:2px;
}
.copyrgt
{
text-align: center;
font-size: 10px;
padding-left:130px;
}
em
{
font-weight: bold;
font-size: 14px;
}
a:link 			{  color: #802080; font-weight: bold;}
a:active		{  color: #802080; font-weight: bold;}
a:visited		{  color: #802080; font-weight: bold;}
a:hover			{  color: #D07030; font-weight: bold;}

.ttl 
{
font-size: 16px;
}

.pagetable
{
border:0px solid #000;
margin:0px 10px;
box-shadow: 0px 0px 15px #888;
}

</STYLE>
</HEAD>



<BODY onselectstart='return false;' ondrag='return false;'>
<FONT id="setfont" face="'comic sans ms',palatino">
<DIV align="center">
<TABLE class="pagetable" align="center" CELLSPACING="0" CELLPADDING="0" width="784" BGCOLOR="#FFFFFF">
<TR>
<TD>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" width="784" height="100%" align="center">
<TR>
	<TD bgcolor="#FFFF90" width="130" height="70" align="center">
	</TD>
	<TD bgcolor="#FFFF90" width="654" height="70" align="center">
	<H1>Bammi.com<FONT size="5"> - Regular Game</FONT></H1>
	</TD>
</TR>
</TABLE>
</TD>
</TR>

<TR>
<TD height="400">
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" width="784" height="100%" align="center">
<TR>
 <TD rowspan="2" width="130" valign="top" class="menucolumn">
	<TABLE class="menutbl" BORDER="0" CELLSPACING="0" CELLPADDING="10" >
<TR><TD align="left">

<SPAN id="menulist">
<P class="menuitem">
<IMG src="images/blob.gif" width="9" height="9" alt="">&nbsp;<A href="/">Home</A>
</P><P class="menuitem">
<IMG src="images/blob.gif" width="9" height="9" alt="">&nbsp;<A href="play.asp">Play Bammi</A>
</P><P class="menuitem">
<IMG src="images/blob.gif" width="9" height="9" alt="">&nbsp;<A href="play.asp?g=big">Big Bammi</A>
</P><P class="menuitem">
<IMG src="images/blob.gif" width="9" height="9" alt="">&nbsp;<A href="play.asp?g=mega">Mega Bammi</A>
</P><P class="menuitem">
<IMG src="images/blob.gif" width="9" height="9" alt="">&nbsp;<A href="about.asp">How to Play</A>
</P><P class="menuitem">
<IMG src="images/blob.gif" width="9" height="9" alt="">&nbsp;<A href="sitemap.asp">Site Map</A>
</P><P class="menutext">&nbsp;<BR>Links:</P>
<P class="menuitem">
<IMG src="images/blob.gif" width="9" height="9" alt="">&nbsp;<A href="http://www.pointlesssites.com" target="_blank">Pointless Sites</A>
</P><P class="menuitem">
<IMG src="images/blob.gif" width="9" height="9" alt="">&nbsp;<A href="http://www.spotthedifference.com" target="_blank">Spot the Difference</A>
</P><P class="menuitem">
<IMG src="images/blob.gif" width="9" height="9" alt="">&nbsp;<A href="http://www.starsigns.com" target="_blank">Star Signs</A>
</P><P class="menuitem">
<IMG src="images/blob.gif" width="9" height="9" alt="">&nbsp;<A href="http://www.dicesimulator.com" target="_blank">Dice Simulator</A>
</P>
</SPAN>
<br>
<p align="center">
<a href="moreinfo.asp" target="_top">Like more<br>information about<br>Bammi?</a>
</p>

</TD></TR>
</TABLE>

<DIV id="socialmediabuttons" class="addthis_toolbox" style="float:left; margin:20px; width:95px; height:130px; padding:10px;">
<!-- AddThis Button BEGIN -->
<table cellpadding="2">
<tr><td><a class="addthis_button_facebook_like" fb:like:layout="button_count"></a></td></tr>
<tr><td><a class="addthis_button_tweet"></a></td></tr>
<tr height="4"></tr>
<tr><td><a class="addthis_button_google_plusone" g:plusone:size="medium"></td></tr>
<tr height="4"></tr>
<tr><td><a class="addthis_counter addthis_pill_style"></a></td></tr>
</table>
<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=ra-4fd5fb8f3ab1b3a9"></script>
<!-- AddThis Button END -->
</DIV>

 </TD>
 <TD valign="top" width="654">
	
<bgsound id="sound" src="" loop="0">
&nbsp;<BR>
<TABLE class="maintbl" BORDER="0" CELLSPACING="0" CELLPADDING="0" align="center">
<TR>
<TD><FONT size="3">Turn all the pies into <span id="flavour"><FONT color='#8080FF'>blueberry</FONT></span> pies<BR>&nbsp;</FONT></TD>
</TR>
<TR><TD><DIV id="playarea" style='position:relative'>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" align="center">
</TABLE>
</DIV></TD></TR>
<TR>
<TD height="35"><SPAN id="turn"></SPAN></TD>
</TR>
<TR>
<TD height="50"><SPAN id="btn">
&nbsp;<BR>&nbsp;
</SPAN></TD>
</TR>
</TABLE>

<SCRIPT language=javascript>
<!--
var html5=false;
var ctx=null;
var canvas=null;
var tmpcanvas=null;
var tmpctx=null;
var cwid=0,chgt=0;
var redpie=null;
var bluepie=null;
var redsplat=null;
var bluesplat=null;
var splatanim=new Array();
var sndboom=null;
var sndclick=null;

try
{
tmpcanvas=document.createElement('canvas');
var t=tmpcanvas.getContext("2d");
html5=true;
}
catch(e)
{
html5=false;
}



var gridid=
[
0,1,2,3,3,4,4,5,3,3,4,4,4,6,7,8,8,8,9,10,11,8,8,12,12 //seemingly random numbers?
];

var capacity=
[
2,3,3,0,0,0,0,3,4,0,0,0,5,4,3,0,0,0,4,3,1,4,0,3,0 //calculated somehow
];


var gridw=5;
var gridh=5;
var cellw=60;
var cellh=60;

var neighbours=
[
[1,4]
,[0,2,4]
,[1,3,5]
,[2,5,6,7]
,[0,1,5,8,6]
,[2,4,3]
,[3,4,7,9]
,[3,6,10]
,[4,11,9,12]
,[6,8,10,12]
,[7,9,12]
,[8]
,[9,10,8]

]
var borders=
[
15,15,15,9,3,9,3,15,12,6,12,4,7,15,15,13,1,3,15,15,15,12,6,13,7
];

function createboard()
{
var b=GetObject("playarea");
if (html5)
{
	var h="";

	h="<canvas id='board' width='300' height='300' style='border:1px solid #000'>Sorry, this browser does not support canvas.</canvas>";

	b.innerHTML=h;

	canvas=document.getElementById("board");
	canvas.addEventListener('mousedown', onclick);
	ctx=canvas.getContext("2d");
	tmpcanvas.width=canvas.width;
	tmpcanvas.height=canvas.height;
	tmpctx=tmpcanvas.getContext("2d");
	cwid=canvas.width;
	chgt=canvas.height;
	redpie=new Image();
	redpie.src="images/cherrypie.png";
	bluepie=new Image();
	bluepie.src="images/blueberrypie.png";
	redsplat=new Image();
	redsplat.src="images/cherrysplat.png";
	bluesplat=new Image();
	bluesplat.src="images/blueberrysplat.png";
	sndboom=new Audio("fx/boom.wav");
	sndclick=new Audio("fx/click.wav");
}
else
{
	var h="";
	h+='<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" align="center">';
	for (var y=0; y<gridh; y++)
	{
		h+="<TR height='"+cellh+"'>";
		for (var x=0; x<gridw; x++)
		{
			var z=x+y*gridw;
			h+="<TD width='"+cellw+"' id='g"+x+"_"+y+"' class='tx"+borders[z]+"' bgcolor='#FFFFE0' onclick='clk("+gridid[z]+")'>";
			if (capacity[z]>0)
			{
				h+='<IMG id="pie'+z+'" src="images/pie/pie'+capacity[z]+'w.jpg">';
			}
			else
			{
				h+="&nbsp;";
			}
			h+="</TD>";
		}
		h+="</TR>";
	}
	h+='</TABLE>';
	b.innerHTML=h;
}
}
createboard();

var nmoves=0;
var E_NONE=-1;
var E_BLUE=0;
var E_RED=1;

var bgcolourcode=["#D0D0FF","#FFD0D0"];
var colourcode=["#8080FF","#FF8080"];
var piecolour=["#0000B0","#B00000"];
var pro=["You","I"];
var turn=E_NONE;
var twoplayergame=false;
//nextturn();

function playgame()
{
if (turn==E_NONE)
{
	GetObject("btn").innerHTML="<FONT size='3'><A href='javascript:setplayers(1);'>Play solo</A>&nbsp;&nbsp;&nbsp;<A href='javascript:setplayers(2);'>Play 2-players</A>&nbsp;&nbsp;&nbsp;<A href='/'><BR>Choose another size</A></FONT>";
}
else
{
	GetObject("btn").innerHTML="&nbsp;<BR>&nbsp;";
	nmoves=0;
	nextturn();
}
}

var exploding=new Array();
var previousid=-1;
var idcnt=new Array();
var idown=new Array();
for (var i=0; i<neighbours.length; i++)
{
idcnt[i]=0;
idown[i]=E_NONE;
}

///////////
//HTML5-related code
///////////

function setcellbg(x,y,c)
{
ctx.fillStyle=c;
ctx.fillRect(x*cellw,y*cellh,cellw,cellh);
}


function onclick(event)
{
var rect = canvas.getBoundingClientRect(); // abs. size of element
var scaleX = canvas.width / rect.width;    // relationship bitmap vs. element for X
var scaleY = canvas.height / rect.height;  // relationship bitmap vs. element for Y

var mouseX = (event.clientX - rect.left)*scaleX;
var mouseY = (event.clientY - rect.top)*scaleY;

//	var mouseX = event.layerX || event.offsetX;
//	var mouseY = event.layerY || event.offsetY;
var gx=Math.floor(mouseX/cellw);
var gy=Math.floor(mouseY/cellh);
clk(gridid[gx+gy*gridw]);
}

function drawpie(own,cnt,max,x,y)
{
ctx.save();
ctx.strokeStyle="#808080";
ctx.lineWidth=1;
var r=(cellw>>3)*3;
var dth=Math.PI*2/max;
var th=-Math.PI*0.5;
for (var i=0; i<max; i++)
{
	ctx.beginPath();
	if (max>1)
	{
		ctx.moveTo(x,y)
		ctx.lineTo(x+r*Math.cos(th),y+r*Math.sin(th));
	}
	ctx.arc(x,y,r,th,th+dth);
	if (max>1)
		ctx.lineTo(x,y);
	ctx.fillStyle=(own==E_NONE || i>=cnt)?"#FFFFFF":piecolour[own];
	ctx.fill();
	ctx.stroke();
	th+=dth;
}
if (cnt>0)
{
	th=-Math.PI*0.5;
	ctx.beginPath();
	ctx.lineWidth=4;
	ctx.strokeStyle="#B0B000";
	ctx.arc(x,y,r,th,th+dth*cnt);
	ctx.stroke();
}
if (own!=E_NONE)
{
	var pie=(own==E_BLUE)?bluepie:redpie;
	r=pie.width>>1;
	ctx.beginPath();
	if (max==1)
		ctx.arc(x,y,r,th,th+dth);
	else
	{
		ctx.moveTo(x,y)
		ctx.lineTo(x+r*Math.cos(th),y+r*Math.sin(th));
		ctx.arc(x,y,r,th,th+cnt*dth);
		ctx.lineTo(x,y);
	}
	ctx.clip();
	ctx.drawImage(pie,x-r,y-r);
}
ctx.restore();
}

function drawcellborder(x,y)
{
var z=x+y*gridw;
var X=x*cellw, Y=y*cellh;
var bd=borders[z];
ctx.lineWidth=2;
if (bd&1)
{
	ctx.beginPath();
	ctx.moveTo(X,Y);
	ctx.lineTo(X+cellw,Y);
	ctx.stroke();
}
if (bd&2)
{
	ctx.beginPath();
	ctx.moveTo(X+cellw,Y);
	ctx.lineTo(X+cellw,Y+cellh);
	ctx.stroke();
}
if (bd&4)
{
	ctx.beginPath();
	ctx.moveTo(X+cellw,Y+cellh);
	ctx.lineTo(X,Y+cellh);
	ctx.stroke();
}
if (bd&8)
{
	ctx.beginPath();
	ctx.moveTo(X,Y+cellh);
	ctx.lineTo(X,Y);
	ctx.stroke();
}
}

function drawcell(x,y)
{
var z=x+y*gridw;
var id=gridid[z];
var own=idown[id];
var cnt=idcnt[id];
var max=neighbours[id].length;
var bd=borders[z];
var X=x*cellw, Y=y*cellh;
if (own!=E_NONE)
{
	setcellbg(x,y,bgcolourcode[own])
}
drawcellborder(x,y);
if (capacity[z]!=0)
{
	drawpie(own,cnt,max,X+(cellw>>1),Y+(cellh>>1));
}
tmpctx.drawImage(canvas,X,Y,cellw,cellh,X,Y,cellw,cellh);
}

function drawboard()
{
if (html5)
{
	ctx.save();
	ctx.fillStyle="#FFFFF0";
	ctx.fillRect(0,0,cwid,chgt);
	ctx.strokeStyle="#000000";
	ctx.lineWidth=1;
	for (var y=0; y<gridh; y++)
	{
		for (var x=0; x<gridw; x++)
		{
			drawcell(x,y);
		}
	}
	ctx.restore();
}
else
{
	for (var y=0; y<gridh; y++)
	{
		for (var x=0; x<gridw; x++)
		{
			var o=GetObject("g"+x+"_"+y);
			o.bgColor=colourcode[t];
		}
	}
}
}

drawboard();


var animtmo=null;
var animcd=0;
function anim()
{
if (animtmo==null)
	animcd=45;
animcd-=1;
if (animcd==0)
{
	animcd=35;
	if (exploding.length>0)
	{
		playSound("boom");
//			playSound("splat"+Math.floor(Math.random()*5+1));
		var id=exploding[0];
		exploding.splice(0,1);
		var ncnt=idcnt[id]-neighbours[id].length;
		if (ncnt>0)
		{
			var n=neighbours[id].length;
			var src=piepos(id);
			for (var i=0; i<n; i++)
			{
				var o=new Object();
				o.src=src;
				o.dest=piepos(neighbours[id][i]);
				o.phase=0;
				o.colour=idown[id];
				o.destid=neighbours[id][i];
				o.srcid=id;
				splatanim.push(o);
			}
			set(id,ncnt,idown[id]);
		}
	}
}
if (splatanim.length!=0)
{
	// erase old splats
	var r=(redsplat.width+redsplat.height)>>1;
	for (var i=splatanim.length-1; i>=0; i-=1)
	{
		var o=splatanim[i];
		var x=o.src.x+(o.dest.x-o.src.x)*o.phase;
		var y=o.src.y+(o.dest.y-o.src.y)*o.phase;
		x=Math.floor((x+0.5)*cellw);
		y=Math.floor((y+0.5)*cellh);

		ctx.drawImage(tmpcanvas,x-r,y-r,r*2,r*2,x-r,y-r,r*2,r*2);
	}
	// draw new splats
	for (var i=splatanim.length-1; i>=0; i-=1)
	{
		var o=splatanim[i];
		o.phase+=0.1;
		if (o.phase>1)
		{
			splatanim.splice(i,1);
			var did=o.destid;
			idown[did]=idown[o.srcid];
			set(did,idcnt[did]+1,idown[did]);
		}
		else
		{
		  ctx.save();
			var img=(o.colour==E_BLUE)?bluesplat:redsplat;
			var x=o.src.x+(o.dest.x-o.src.x)*o.phase;
			var y=o.src.y+(o.dest.y-o.src.y)*o.phase;
			x=(x+0.5)*cellw;
			y=(y+0.5)*cellh;
			var a=Math.atan2(o.dest.x-o.src.x,-(o.dest.y-o.src.y));
			ctx.beginPath();
			ctx.translate(x,y);
			ctx.rotate(a);
			ctx.translate(-x,-y);
			ctx.drawImage(img, x-(img.width>>1),y-(img.height>>1));
		  ctx.restore();
		}
	}
}
// jiggle exploding pies
for (var y=0; y<gridh; y++)
{
	for (var x=0; x<gridw; x++)
	{
		var z=x+y*gridw;
		if (capacity[z]>0 && idcnt[gridid[z]]>capacity[z])
		{
			var id=gridid[z];
			setcellbg(x,y,bgcolourcode[idown[id]]);
			setborder(id,"#FF00FF");
			var dx=Math.floor(Math.random()*6)-3;
			var dy=Math.floor(Math.random()*6)-3;
			if (n==1) dx=dy=0;
			var cnt=neighbours[id].length;
			drawpie(idown[id],cnt,cnt,x*cellw+(cellw>>1)+dx,y*cellh+dy+(cellh>>1));
		}
	}
}
if (checkwin() || (splatanim.length==0 && exploding.length==0))
{
	clearTimeout(animtmo);
	animtmo=null;
	nextturn();
}
else
{
	animtmo=setTimeout("anim()",25);
}
}

function setborder(id,clr)
{
if (html5)
{
	ctx.save();
	ctx.strokeStyle=clr;
	for (var y=0; y<gridh; y++)
	{
		for (var x=0; x<gridw; x++)
		{
			var z=x+y*gridw;
			if (gridid[z]==id)
			{
				drawcellborder(x,y);
			}
		}
	}
	ctx.restore();
}
else
{
	for (var y=0; y<gridh; y++)
	{
		for (var x=0; x<gridw; x++)
		{
			var z=x+y*gridw;
			if (gridid[z]==id)
			{
				var o=GetObject("g"+x+"_"+y);
				o.style.borderColor=clr;
			}
		}
	}
}
}

//////////
//End of HTML5-related code
//////////

function animating()
{
if (html5)
	return (animtmo!=null);
else
	return (exploding.length>0);
}


var ua=String(navigator.userAgent).toLowerCase();
var iPad=(ua.indexOf('applewebkit/')>=0 && ua.indexOf('mobile/')>=0);

function playSound(s) 
{
if (iPad)
	return; // Apple don't follow the HTML5 audio standard so no sound for iOS

if (html5)
{
	if (s=="click")
	{
		sndclick.load();
		sndclick.play();
	}
	else if (s=="boom")
	{
		sndboom.load();
		sndboom.play();
	}
	else
	{
		var snd = new Audio("fx/"+s+".wav"); // buffers automatically when created
		snd.play();
	}
}
else
{
	if (document.all)
	{
		document.all.sound.src = "fx/"+s+".wav";
	}
}
}




function setplayers(np)
{
twoplayergame=(np==2);
turn=Math.random()>0.5?E_BLUE:E_RED;
playgame();
}

function checkwin()
{
var nr=0;
var nb=0;
var nn=0;
for (var i=0; i<idown.length; i++)
{
	if (idown[i]==E_BLUE)
		nb++;
	if (idown[i]==E_RED)
		nr++;
	if (idown[i]==E_NONE)
		nn++;
}
if (nn==0)
{
	if (nr==0 || nb==0)
	{
		var t=(nr==0)?E_BLUE:E_RED;
		drawboard();

		if (!twoplayergame)
		{
			var prevbest=gamedata[0].best;
			updateGameData(0,(nr==0),nmoves);
		}

		var w=(nr==0?0:1);
		var msg;
		if (twoplayergame)
		{
			msg=(w==0?"Blue":"Red")+" wins in "+nmoves+" moves.";
		}
		else
		{
			msg=(w==0?"You":"I")+" win in "+nmoves+" moves.";
		}
		if (nr==0 && !twoplayergame)
		{
			if (nmoves<prevbest)
				msg+=" (New best!)";
			else
				msg+=" (Best="+prevbest+")";
		}
		GetObject("turn").innerHTML="<FONT color='"+colourcode[w]+"' size='4'>"+msg+"</FONT>";
		GetObject("btn").innerHTML="<FONT size='3'><A href='javascript:again(1);'>Play solo</A>&nbsp;&nbsp;&nbsp;<A href='javascript:again(2);'>Play 2-players</A>&nbsp;&nbsp;&nbsp;<A href='/'><BR>Choose another size</A></FONT>";
		turn=E_NONE;
		return true;

	}
}
return false;
}

function again(nplayers)
{
document.location="play.asp?g=reg&p="+nplayers;
}

function turnname(t)
{
if (twoplayergame)
{
	return (t==0)?"Blue's turn":"Red's turn";
}
else
{
	return (t==0)?"Your turn":"My turn";
}
}

function nextturn()
{
if (turn==E_BLUE || turn==E_RED)
{
	turn=(E_BLUE+E_RED)-turn;
	var m5="<FONT color='"+colourcode[turn]+"' size='5'>"+turnname(turn);
	GetObject("turn").innerHTML=m5;		
	if (twoplayergame)
	{
		var clr="<FONT color='"+colourcode[turn]+"'>";
		if (turn==E_BLUE)
		{
			GetObject("flavour").innerHTML=clr+"blueberry</FONT>";
		}
		else
		{
			GetObject("flavour").innerHTML=clr+"raspberry</FONT>";
		}
		var clr="color='"+colourcode[turn]+"'"
	}
}
if (turn==E_RED && !twoplayergame)
{
	setTimeout("thinking(11)",100);
}
}

// Get named HTML object
function GetObject(name)
{
var o=null;
if(document.getElementById)
	o=document.getElementById(name);
else if(document.all)
	o=document.all.item(name);
else if(document.layers)
	o=document.layers[name];
if (o==null && document.getElementsByName)
{
	var e=document.getElementsByName(name);
	if (e.length==1) o=e[0];
}
return o;
}

var gamedata=new Array();

// read cookie containing game data
function readcookie()
{
gamedata=new Array();
for (var i=0; i<3; i++)
{
	gamedata[i]=new Object();
	gamedata[i].played=0;
	gamedata[i].won=0;
	gamedata[i].best=1000000;
}
var allcookies=document.cookie;
var pos=allcookies.indexOf("gamedata=");
if (pos!=-1)
{
	var start=pos+9;
	var end=allcookies.indexOf(";", start);
	if (end==-1) end=allcookies.length;
	var value=allcookies.substring(start, end);
	var gd=value.split(",");
	for (var i=0; i<gd.length; i++)
	{
		var g=gd[i].split(".");
		gamedata[i].played=parseInt(g[0]);
		gamedata[i].won=parseInt(g[1]);
		gamedata[i].best=parseInt(g[2]);
	}
}
}

function updateGameData(gm, wn, mvs)
{
gamedata[gm].played+=1;
if (wn)
{
	gamedata[gm].won+=1;
	if (mvs<gamedata[gm].best)
		gamedata[gm].best=mvs;
}
var gd="";
for (var i=0; i<gamedata.length; i++)
	gd+=","+gamedata[i].played+"."+gamedata[i].won+"."+gamedata[i].best;
gd=gd.substr(1);
var exp=new Date((new Date()).getTime()+365*24*60*60000); // expire in 1 year
document.cookie="gamedata="+gd+"; expires="+exp.toGMTString();
}


function clearcookie()
{
var exp=new Date((new Date()).getTime()-365*24*60*60000); // 1 year ago
document.cookie="gamedata=<none>; expires="+exp.toGMTString(); 
readcookie();
}

function piepos(id)
{
for (var y=0; y<gridh; y++)
{
	for (var x=0; x<gridw; x++)
	{
		var z=x+y*gridw;
		if (gridid[z]==id && capacity[z]>0)
			return {x:x, y:y};
	}
}
return null;
}

function drawid(id)
{
for (var y=0; y<gridh; y++)
{
	for (var x=0; x<gridw; x++)
	{
		var z=x+y*gridw;
		if (gridid[z]==id)
			drawcell(x,y);
	}
}
}

function explode(t)
{
var n=exploding.length;
var nx=new Array();
for (var i=0; i<n; i++)
	nx[i]=exploding[i];
exploding=new Array();
for (var j=0; j<n; j++)
{
	var id=nx[j];
	var ncnt=idcnt[id]-neighbours[id].length;
	if (ncnt>0)
	{
		set(id,ncnt,t);
		for (var i=0; i<neighbours[id].length; i++)
		{
			var nn=neighbours[id][i];
			idown[nn]=t;
			set(nn,idcnt[nn]+1,t);
		}
	}
}
if (!checkwin() && exploding.length>0)
{
	setTimeout("flicker("+t+",5)",500);
}
else
{
	nextturn();
}
}

function set(id,val,t)
{
idcnt[id]=val;
idown[id]=t;
var c=val;
var cmax=neighbours[id].length;
if (html5)
	drawid(id);
else
{
	for (var y=0; y<gridh; y++)
	{
		for (var x=0; x<gridw; x++)
		{
			var z=x+y*gridw;
			if (gridid[z]==id)
			{
				var o=GetObject("g"+x+"_"+y);
				o.bgColor=colourcode[t];
				if (c>cmax) o.bgColor="#B000B0";
				var cl="#B080B0";
				if (c>=cmax) cl="#FFFFFF";
				if (capacity[z]!=0)
				{
					var nn=val;
					if (nn>capacity[z])
						nn=capacity[z];
					val-=nn;
					o=GetObject("pie"+z);
					var b=(t==E_RED)?"r":"b";
					o.src="images/pie/pie"+capacity[z]+b+nn+".jpg";
				}
			}
		}
	}
}
if (c>cmax)
{
	for (var i=0; i<exploding.length; i++)
		if (exploding[i]==id) break;
	if (i==exploding.length)
		exploding.push(id);
}
}

function flicker(t,n)
{
if (n==0)
{
	playSound("boom");
	explode(t);
}
else
{
	for (var y=0; y<gridh; y++)
	{
		for (var x=0; x<gridw; x++)
		{
			var z=x+y*gridw;
			for (var i=0; i<exploding.length; i++)
			{
				if (gridid[z]==exploding[i])
				{
					var o=GetObject("g"+x+"_"+y);
					if (((n&1)==0) && idcnt[gridid[z]]>neighbours[gridid[z]].length)
						o.bgColor="#B000B0";
					else 
						o.bgColor=colourcode[t];
				}
			}
		}
	}
	if ((n&1)==0)
		playSound("tick");
	setTimeout("flicker("+t+","+(n-1)+")",200);
}
}

function doclk(id)
{
playSound("click");
nmoves++;
set(id,idcnt[id]+1,turn);
setborder(previousid,"#000");
setborder(id,"#F0F");
previousid=id;
if (html5)
	anim();
else
{
	if (!checkwin() && exploding.length>0)
	{
		setTimeout("flicker("+turn+",7)",200);
	}
	else
	{
		nextturn();
	}
}
}

function clk(id)
{
if (turn==E_NONE)
	return
if (turn!=E_BLUE && !twoplayergame)
	return;
if ((idown[id]==turn || idown[id]==E_NONE) && !animating())
{
	if (html5)
		setTimeout("doclk("+id+")",1);
	else
		doclk(id);
}
}

function autoplay()
{
if (turn==E_NONE || exploding.length>0)
	return;

var score=new Array();
for (var id=0; id<idcnt.length; id++)
{
	var sc=0;
	var nb=neighbours[id]
	if (idown[id]==E_NONE)
	{
		if (nb.length>5) sc+=11;
		else sc+=17-nb.length;
	}
	else if (idown[id]!=turn)
		sc=-1000000;
	else
	{
		var pr=nb.length-idcnt[id];
		if (pr==0) // we are primed
		{
			for (var i=0; i<nb.length; i++)
			{
				var ni=nb[i];
				if (idown[ni]!=turn && idown[ni]!=E_NONE)
				{
					var nbl=neighbours[ni].length;
					if (idcnt[ni]==nbl) // primed enemy neighbour
					{
						sc+=nbl*8;
					}
					else if (idcnt[ni]==nbl-1) // sub-primed enemy neighbour
					{
						sc+=nbl*2;
					}
					else
					{
						//sc+=nbl;
					}
				}
			}
		}
		else if (pr==1) // we are subprimed
		{
			for (var i=0; i<nb.length; i++)
			{
				var ni=nb[i];
				if (idown[ni]!=turn && idown[ni]!=E_NONE)
				{
					var nbl=neighbours[ni].length;
					if (idcnt[ni]==nbl) // primed enemy neighbour
					{
						sc-=nbl*30;
					}
					else if (idcnt[ni]==nbl-1) // sub-primed enemy neighbour
					{
						sc+=nbl*8;
					}
					else
					{
						sc+=nbl;
					}
				}
			}
		}
		else
		{
			for (var i=0; i<nb.length; i++)
			{
				var ni=nb[i];
				if (idown[ni]!=turn && idown[ni]!=E_NONE)
				{
					var nbl=neighbours[ni].length;
					if (idcnt[ni]==nbl) // primed enemy neighbour
					{
						sc-=nbl;
					}
					else if (idcnt[ni]==nbl-1) // sub-primed enemy neighbour
					{
						sc+=nbl;
					}
					else
					{
						sc+=nbl;
					}
				}
			}
		}
	}
	score[id]=sc;
}	
var idx=0;
for (i=0; i<score.length; i++)
{
	if (score[i]>score[idx]) idx=i;
}
if (score[idx]>-500000)
	doclk(idx);
}

function thinking(n)
{
var t=GetObject("turn").innerHTML;
GetObject("turn").innerHTML="."+t+".";
if (n==0)
	autoplay();
else
	setTimeout("thinking("+(n-1)+")",100);
}


readcookie();
playgame();
-->
</SCRIPT>
 </TD>
</TR>
<TR align="center">
 <TD>
	<p align="center">
<br>
<span class="normal">
<A href="mailto:?subject=www.Bammi.com &body=Take a look at this Original Exploding Pie Game!"
>Tell a friend</A>&nbsp;&nbsp;-&nbsp;&nbsp;<A href="sitemap.asp">Sitemap</A><BR>
&nbsp;<BR>
Want to try some other games? Visit <a href='http://www.pointlesssites.com' target='_blank'>PointlessSites.com</a>
for loads more fun.
<br>&nbsp;
</span>
</p>

 </TD>
</TR>
</TABLE>
</TD>
</TR>
</TABLE>
</DIV>
<DIV class="copyrgt">
Bammi &copy; 2021&nbsp;<A href="https://www.dlcwebsites.com">DLC Websites</A>
</DIV>

</FONT>
</BODY>

</HTML>
